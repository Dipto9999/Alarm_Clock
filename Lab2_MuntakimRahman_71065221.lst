0000              1   ; Lab2_MuntakimRahman_71065221.asm:
0000              2   ;        A) Drives A 16x2 LCD Display Using 4-Bit Mode and Displays 12-Hour Clock Time
0000              3   ;   b) Generates A 2kHz Square Wave at Pin P1.7 Using an ISR For Timer 0.
0000              4   ;      Drives A Speaker When Alarm is Activated.
                  6   $LIST
0000              8   
0000              9   ;  N76E003 pinout:
0000             10   ;                               -------
0000             11   ;       PWM2/IC6/T0/AIN4/P0.5 -|1    20|- P0.4/AIN5/STADC/PWM3/IC3
0000             12   ;               TXD/AIN3/P0.6 -|2    19|- P0.3/PWM5/IC5/AIN6
0000             13   ;               RXD/AIN2/P0.7 -|3    18|- P0.2/ICPCK/OCDCK/RXD_1/[SCL]
0000             14   ;                    RST/P2.0 -|4    17|- P0.1/PWM4/IC4/MISO
0000             15   ;        INT0/OSCIN/AIN1/P3.0 -|5    16|- P0.0/PWM3/IC3/MOSI/T1
0000             16   ;              INT1/AIN0/P1.7 -|6    15|- P1.0/PWM2/IC2/SPCLK
0000             17   ;                         GND -|7    14|- P1.1/PWM1/IC1/AIN7/CLO
0000             18   ;[SDA]/TXD_1/ICPDA/OCDDA/P1.6 -|8    13|- P1.2/PWM0/IC0
0000             19   ;                         VDD -|9    12|- P1.3/SCL/[STADC]
0000             20   ;            PWM5/IC7/SS/P1.5 -|10   11|- P1.4/SDA/FB/PWM1
0000             21   ;                               -------
0000             22   ;
0000             23   
0000             24   ;-------------------;
0000             25   ; Clock FrEQUencies ;
0000             26   ;-------------------;
0000             27   CLK           EQU 16600000 ; Microcontroller System Frequency in Hz
0000             28   
0000             29   TIMER0_RATE   EQU 4096     ; 2048Hz Squarewave (Peak Amplitude of CEM-1203 Speaker)
0000             30   TIMER0_RELOAD EQU ((65536-(CLK/TIMER0_RATE)))
0000             31   
0000             32   TIMER2_RATE   EQU 1000     ; 1000Hz, for Timer Tick of 1ms
0000             33   TIMER2_RELOAD EQU ((65536-(CLK/TIMER2_RATE)))
0000             34   
0000             35   ;-----------------;
0000             36   ; Pin Definitions ;
0000             37   ;-----------------;
0000             38   SET_BUTTON           EQU P1.0 ; Pin 15
0000             39   HOUR_FORMAT_BUTTON   EQU P1.1 ; Pin 14
0000             40   
0000             41   
0000             42   DEC_BUTTON           EQU P0.5 ; Pin 1
0000             43   HOURS_BUTTON         EQU P1.2 ; Pin 13
0000             44   MINUTES_BUTTON       EQU P1.6 ; Pin 8
0000             45   SECONDS_BUTTON       EQU P3.0 ; Pin 5
0000             46   
0000             47   ALARM_OUT            EQU P1.7 ; Pin 6
0000             48   
0000             49   ;-------------------;
0000             50   ; Interrupt Vectors ;
0000             51   ;-------------------;
0000             52   ; Reset Vector
0000             53   ORG 0X0000
0000 0201C2      54       LJMP Main
0003             55   
0003             56   ; External Interrupt 0 Vector (Not Used)
0003             57   ORG 0X0003
0003 32          58            RETI
0004             59   
0004             60   ; Timer/Counter 0 Overflow Interrupt Vector
000B             61   ORG 0X000B
000B 020136      62            LJMP Timer0_ISR
000E             63   
000E             64   ; External Interrupt 1 vector (Not Used)
0013             65   ORG 0X0013
0013 32          66            RETI
0014             67   
0014             68   ; Timer/Counter 1 Overflow Interrupt Vector (Not Used)
001B             69   ORG 0X001B
001B 32          70            RETI
001C             71   
001C             72   ; Serial Port Receive/Transmit Interrupt Vector (Not Used)
0023             73   ORG 0X0023
0023 32          74            RETI
0024             75   
0024             76   ; Timer/Counter 2 Overflow Interrupt Vector
002B             77   ORG 0X002B
002B 020176      78            LJMP Timer2_ISR
002E             79   
002E             80   ; Note : Can Define Direct Access Variables Starting at 0X30 up to 0X7F in 8051.
0030             81   DSEG AT 0X30
0030             82   
0030             83   Counter_1ms:       DS 2 ; Used to Determine When 1000ms has Passed
0032             84   
0032             85   BCD_Time_Hours: DS 1
0033             86   BCD_Time_Minutes:  DS 1
0034             87   BCD_Time_Seconds:  DS 1
0035             88   
0035             89   BCD_Alarm_Hours: DS 1
0036             90   BCD_Alarm_Minutes: DS 1
0037             91   
0000             92   BSEG
0000             93   
0000             94   One_Second_Flag: DBIT 1 ; Set Bit In ISR After Every 1000ms
0001             95   
0001             96   Init_Time_Flag: DBIT 1 ; Set Bit When Time is Being Initialized
0002             97   Dec_En_Flag: DBIT 1 ; Set Bit When Decrement Button is Toggled
0003             98   
0003             99   Alarm_En_Flag:   DBIT 1
0004            100   Alarm_On_Flag:   DBIT 1
0005            101   
0005            102   Time_PM_Flag:    DBIT 1 ; Set Bit When Time is in PM
0006            103   Alarm_PM_Flag:   DBIT 1 ; Set Bit When Alarm is in PM
0007            104   Hour_Format_Flag:    DBIT 1 ; Set Bit When Time is in 24-Hour Mode
0008            105   
002E            106   CSEG
002E            107   
002E            108   LCD_RS EQU P1.3 ; Pin 12
002E            109   LCD_E  EQU P1.4 ; Pin 11
002E            110   LCD_D4 EQU P0.0 ; Pin 16
002E            111   LCD_D5 EQU P0.1 ; Pin 17
002E            112   LCD_D6 EQU P0.2 ; Pin 18
002E            113   LCD_D7 EQU P0.3 ; Pin 19
002E            114   
                116   	$LIST
00E2            118   
00E2 54494D45   119   TIME_INIT_MSG:     DB 'TIME xx:xx:xxxx', 0, 0
     2078783A
     78783A78
     78787800
     00
00F3 414C4152   120   ALARM_INIT_MSG:    DB 'ALARM xx:xxxx', 0
     4D207878
     3A787878
     7800
0101 414C4152   121   ALARM_UPDATE_MSG:  DB 'ALARM', 0
     4D00
0107            122   
0107 414D00     123   AM_MSG: DB 'AM', 0
010A 504D00     124   PM_MSG: DB 'PM', 0
010D            125   
010D 20202020   126   BLANK_DISPLAY: DB '                ', 0
     20202020
     20202020
     20202020
     00
011E 3A00       127   COLON: DB ':', 0
0120            128   
0120            129   ;---------------------------------------;
0120            130   ; Routine to Initialize ISR for Timer 0 ;
0120            131   ;---------------------------------------;
0120            132   Timer0_Init:
0120 438E08     133            ORL CKCON, #0B0000_1000 ; Input for Timer 0 is SYSCLK/1.
0123            134   
0123 E589       135            MOV A, TMOD
0125 54F0       136            ANL A, #0XF0 ; 1111_0000 Clear Bits for Timer 0
0127 4401       137            ORL A, #0X01 ; 0000_0001 Configure Timer 0 as 16-Timer
0129 F589       138            MOV TMOD, A
012B            139   
012B 758CF0     140            MOV TH0, #HIGH(TIMER0_RELOAD)
012E 758A2C     141            MOV TL0, #LOW(TIMER0_RELOAD)
0131            142   
0131            143            ; Enable Timer and Interrupts
0131 D2A9       144       SETB ET0  ; Enable Timer 0 Interrupt
0133 D28C       145            SETB TR0  ; Start Timer 0
0135 22         146            RET
0136            147   
0136            148   ;---------------------------------;
0136            149   ; ISR for Timer 0. Set to Execute ;
0136            150   ; Every 1/4096Hz to Generate a    ;
0136            151   ; 2048 Hz Wave at Pin ALARM_OUT   ;
0136            152   ;---------------------------------;
0136            153   Timer0_ISR:
0136            154            ; Save Registers to Stack.
0136 C0E0       155       PUSH ACC
0138 C0D0       156            PUSH PSW
013A            157   
013A 300311     158            JNB Alarm_En_Flag, No_Sound
013D 30040E     159            JNB Alarm_On_Flag, No_Sound
0140            160   Generate_Sound:
0140 C28C       161            CLR TR0 ; Stop Timer 0.
0142            162            ; Timer 0 Doesn't Have 16-Bit Auto-Reload.
0142 758CF0     163            MOV TH0, #HIGH(TIMER0_RELOAD)
0145 758A2C     164            MOV TL0, #LOW(TIMER0_RELOAD)
0148 D28C       165            SETB TR0
014A            166   
014A B297       167            CPL ALARM_OUT ; Toggle the Alarm Out Pin
014C 8006       168            SJMP Timer0_ISR_Done
014E            169   No_Sound:
014E            170            ; Timer 0 Doesn't Have 16-Bit Auto-Reload.
014E 758CF0     171            MOV TH0, #HIGH(TIMER0_RELOAD)
0151 758A2C     172            MOV TL0, #LOW(TIMER0_RELOAD)
0154            173   Timer0_ISR_Done:
0154            174            ; Restore Registers from Stack.
0154 D0D0       175            POP PSW
0156 D0E0       176            POP ACC
0158            177   
0158 32         178            RETI
0159            179   
0159            180   ;---------------------------------------;
0159            181   ; Routine to Initialize ISR for Timer 2 ;
0159            182   ;---------------------------------------;
0159            183   Timer2_Init:
0159 75C800     184            MOV T2CON, #0 ; Stop Timer. Autoreload Mode.
015C            185   
015C 75CDBF     186            MOV TH2, #HIGH(TIMER2_RELOAD)
015F 75CC28     187            MOV TL2, #LOW(TIMER2_RELOAD)
0162            188   
0162            189            ; Set Reload Value
0162 43C980     190            ORL T2MOD, #0X80 ; Enable Timer 2 Autoreload Mode
0165 75CBBF     191            MOV RCMP2H, #HIGH(TIMER2_RELOAD)
0168 75CA28     192            MOV RCMP2L, #LOW(TIMER2_RELOAD)
016B            193   
016B            194            ; Init 1ms Interrupt Counter. 16-bit Variable with Two 8-bit Parts.
016B E4         195            CLR A
016C F530       196            MOV Counter_1ms+0, A
016E F531       197            MOV Counter_1ms+1, A
0170            198   
0170            199            ; Enable the Timer and Interrupts.
0170 439B80     200            ORL EIE, #0X80 ; Enable Timer 2 Interrupt ET2=1
0173 D2CA       201       SETB TR2  ; Enable Timer 2
0175 22         202            RET
0176            203   
0176            204   ;-----------------;
0176            205   ; ISR for Timer 2 ;
0176            206   ;-----------------;
0176            207   Timer2_ISR:
0176 C2CF       208            CLR TF2  ; Timer 2 Doesn't Clear TF2 Automatically. Do it in the ISR.  It is Bit Addressable.
0178 B284       209            CPL P0.4 ; Interrupt Rate with Oscilloscope Must Precisely Be A 1ms Pulse.
017A            210   
017A            211            ; Save Registers to Stack
017A C0E0       212            PUSH ACC
017C C0D0       213            PUSH PSW
017E            214   
017E            215            ; Increment 16-bit 1ms Counter.
017E 0530       216            INC Counter_1ms+0 ; Increment Low 8-bits
0180 E530       217            MOV A, Counter_1ms+0 ; Increment High 8-bits if Lower 8-bits Overflow
0182 7002       218            JNZ Update_BCD
0184 0531       219            INC Counter_1ms+1
0186            220   Update_BCD:
0186            221            ; Check if 1000ms Have Passed
0186 E530       222            MOV A, Counter_1ms+0
0188 B4E832     223            CJNE A, #LOW(1000), Timer2_ISR_Done ; Note : Changes Carry Flag
018B E531       224            MOV A, Counter_1ms+1
018D B4032D     225            CJNE A, #HIGH(1000), Timer2_ISR_Done
0190            226   
0190            227            ; 1000ms Have Passed. Set Flag to Inform Main Program.
0190 D200       228            SETB One_Second_Flag
0192            229   Check_Alarm:
0192 30031E     230            JNB Alarm_En_Flag, No_Alarm
0195            231   
0195            232            ; Check if Time Hours Equals Alarm Hours
0195 E532       233            MOV A, BCD_Time_Hours
0197 B53519     234            CJNE A, BCD_Alarm_Hours, No_Alarm
019A            235   
019A            236            ; Check if Time Minutes Equals Alarm Minutes
019A E533       237            MOV A, BCD_Time_Minutes
019C B53614     238            CJNE A, BCD_Alarm_Minutes, No_Alarm
019F            239   
019F            240            ; Check AM/PM Flag
019F E4         241            CLR A
01A0 F5F0       242            MOV B, A
01A2 A205       243            MOV C, Time_PM_Flag
01A4 92F0       244            MOV B.0, C
01A6 A206       245            MOV C, Alarm_PM_Flag
01A8 92E0       246            MOV ACC.0, C
01AA B5F006     247            CJNE A, B, No_Alarm
01AD            248   BEEP:
01AD D204       249            SETB Alarm_On_Flag
01AF B28C       250            CPL TR0 ; Create Beep-Silence-Beep-Silence Sounds
01B1 8002       251            SJMP Continue_ISR
01B3            252   No_Alarm:
01B3 C204       253            CLR Alarm_On_Flag
01B5            254   Continue_ISR:
01B5            255            ; Reset 1ms Counter to 0.
01B5 E4         256            CLR A
01B6 F530       257            MOV Counter_1ms+0, A
01B8 F531       258            MOV Counter_1ms+1, A
01BA 1205F3     259            LCALL Update_Time_Seconds
01BD            260   Timer2_ISR_Done:
01BD D0D0       261            POP PSW
01BF D0E0       262            POP ACC
01C1 32         263            RETI
01C2            264   
01C2            265   ;----------------------------------;
01C2            266   ; Main Program. Includes Hardware  ;
01C2            267   ; Initialization and Forever Loop. ;
01C2            268   ;----------------------------------;
01C2            269   Main:
01C2            270            ; Initialization
01C2 75817F     271       MOV SP, #0X7F
01C5 75B100     272       MOV P0M1, #0X00
01C8 75B200     273       MOV P0M2, #0X00
01CB 75B300     274       MOV P1M1, #0X00
01CE 75B400     275       MOV P1M2, #0X00
01D1 75AD00     276       MOV P3M2, #0X00
01D4 75AD00     277       MOV P3M2, #0X00
01D7            278   
01D7 120120     279       LCALL Timer0_Init
01DA 120159     280       LCALL Timer2_Init
01DD D2AF       281       SETB EA   ; Enable Global Interrupts
01DF 120087     282       LCALL LCD_4BIT
01E2            283   
01E2            284   Init_Time:
01E2 D201       285            SETB Init_Time_Flag
01E4 D200       286       SETB One_Second_Flag
01E6 C205       287            CLR Time_PM_Flag
01E8 C202       288            CLR Dec_En_Flag
01EA C207       289            CLR Hour_Format_Flag
01EC            290   
01EC C2CA       291            CLR TR2 ; Stop Timer 2
01EE            292   
01EE            293            ; Starting Display is 8:00:00 AM
01EE 7408       294            MOV A, #0X08
01F0 F532       295            MOV BCD_Time_Hours, A
01F2            296   
01F2 7400       297            MOV A, #0X00
01F4 F533       298            MOV BCD_Time_Minutes, A
01F6            299   
01F6 7400       300            MOV A, #0X00
01F8 F534       301            MOV BCD_Time_Seconds, A
01FA            302   
01FA C0E0       303            push acc
01FC 7401       303            mov a, #1
01FE 14         303            dec a
01FF 1200C7     303            lcall ?Set_Cursor_1 ; Select column and row
0202 D0E0       303            pop acc
0204 C083       304            push dph
0206 C082       304            push dpl
0208 C0E0       304            push acc
020A 9000E2     304            mov dptr, #TIME_INIT_MSG
020D 1200BA     304            lcall ?Send_Constant_String
0210 D0E0       304            pop acc
0212 D082       304            pop dpl
0214 D083       304            pop dph
0216            305   Check_Set_Time:
0216 209012     306            JB SET_BUTTON, Init_Time_Display
0219 C002       307            push AR2
021B 7A32       307            mov R2, #50
021D 120038     307            lcall ?Wait_Milli_Seconds
0220 D002       307            pop AR2
0222 209006     308            JB SET_BUTTON, Init_Time_Display
0225 3090FD     309            JNB SET_BUTTON, $ ; Wait for Rising Edge
0228 020276     310            LJMP Init_Time_End
022B            311   Init_Time_Display:
022B 1206B8     312            LCALL Check_Hour_Format
022E 1202D3     313            LCALL Update_Time_Display
0231 1206A3     314            LCALL Check_Dec_En
0234            315   Init_Time_Seconds:
0234 20B012     316            JB SECONDS_BUTTON, Init_Time_Minutes
0237 C002       317            push AR2
0239 7A32       317            mov R2, #50
023B 120038     317            lcall ?Wait_Milli_Seconds
023E D002       317            pop AR2
0240 20B006     318            JB SECONDS_BUTTON, Init_Time_Minutes
0243 30B0FD     319            JNB SECONDS_BUTTON, $ ; Wait for Rising Edge
0246 1205F3     320            LCALL Update_Time_Seconds
0249            321   Init_Time_Minutes:
0249 209612     322            JB MINUTES_BUTTON, Init_Time_Hours
024C C002       323            push AR2
024E 7A32       323            mov R2, #50
0250 120038     323            lcall ?Wait_Milli_Seconds
0253 D002       323            pop AR2
0255 209606     324            JB MINUTES_BUTTON, Init_Time_Hours
0258 3096FD     325            JNB MINUTES_BUTTON, $ ; Wait for Rising Edge
025B 1205C2     326            LCALL Update_Time_Minutes
025E            327   Init_Time_Hours:
025E 209212     328            JB HOURS_BUTTON, Init_Time_Loop
0261 C002       329            push AR2
0263 7A32       329            mov R2, #50
0265 120038     329            lcall ?Wait_Milli_Seconds
0268 D002       329            pop AR2
026A 209206     330            JB HOURS_BUTTON, Init_Time_Loop
026D 3092FD     331            JNB HOURS_BUTTON, $ ; Wait for Rising Edge
0270 120585     332            LCALL Update_Time_Hours
0273            333   Init_Time_Loop:
0273 020216     334            LJMP Check_Set_Time
0276            335   Init_Time_End:
0276 D2CA       336            SETB TR2 ; Set Timer 2
0278 C201       337            CLR Init_Time_Flag
027A            338   Init_Alarm:
027A D203       339            SETB Alarm_En_Flag
027C C204       340            CLR Alarm_On_Flag
027E            341   
027E            342            ; Starting Alarm is 06:00 AM
027E C206       343            CLR Alarm_PM_Flag
0280 7406       344            MOV A, #0X06
0282 F535       345            MOV BCD_Alarm_Hours, A
0284            346   
0284 7400       347            MOV A, #0X00
0286 F536       348            MOV BCD_Alarm_Minutes, A
0288            349   
0288 0202C5     350            LJMP Update_LCD_Display
028B            351   
028B            352   ;------------------------------------------------------;
028B            353   ; Forever Loop to Check Buttons and Update LCD Display ;
028B            354   ;------------------------------------------------------;
028B            355   Check_Buttons:
028B 8000       356            SJMP Check_Update_Alarm
028D            357   Check_Update_Alarm:
028D 12068E     358            LCALL Check_Alarm_En
0290 1206A3     359            LCALL Check_Dec_En
0293 200303     360            JB Alarm_En_Flag, Check_Update_Alarm_Minutes
0296 0202C5     361            LJMP Update_LCD_Display
0299            362   Check_Update_Alarm_Minutes:
0299 209612     363            JB MINUTES_BUTTON, Check_Update_Alarm_Hours
029C C002       364            push AR2
029E 7A32       364            mov R2, #50
02A0 120038     364            lcall ?Wait_Milli_Seconds
02A3 D002       364            pop AR2
02A5 209606     365            JB MINUTES_BUTTON, Check_Update_Alarm_Hours
02A8 3096FD     366            JNB MINUTES_BUTTON, $ ; Wait for Rising Edge
02AB 120660     367            LCALL Update_Alarm_Minutes ; Increment Alarm Minutes
02AE            368   Check_Update_Alarm_Hours:
02AE 209214     369            JB HOURS_BUTTON, Update_LCD_Display
02B1 C002       370            push AR2
02B3 7A32       370            mov R2, #50
02B5 120038     370            lcall ?Wait_Milli_Seconds
02B8 D002       370            pop AR2
02BA 209208     371            JB HOURS_BUTTON, Update_LCD_Display
02BD 3092FD     372            JNB HOURS_BUTTON, $ ; Wait for Rising Edge
02C0 120624     373            LCALL Update_Alarm_Hours ; Increment Alarm Hours
02C3 8000       374            SJMP Update_LCD_Display
02C5            375   Update_LCD_Display:
02C5 C200       376       CLR One_Second_Flag
02C7 1206B8     377            LCALL Check_Hour_Format
02CA 1202D3     378            LCALL Update_Time_Display
02CD 120407     379            LCALL Update_Alarm_Display
02D0 02028B     380            LJMP Check_Buttons
02D3            381   
02D3            382   ;--------------------;
02D3            383   ; Update LCD Display ;
02D3            384   ;--------------------;
02D3            385   Update_Time_Display:
02D3            386            ; Display Time
02D3 C0E0       387            push acc
02D5 7409       387            mov a, #9
02D7 14         387            dec a
02D8 1200C7     387            lcall ?Set_Cursor_1 ; Select column and row
02DB D0E0       387            pop acc
02DD C000       388            push ar0
02DF A833       388            mov r0, BCD_Time_Minutes
02E1 1200CC     388            lcall ?Display_BCD
02E4 D000       388            pop ar0
02E6 C0E0       389            push acc
02E8 740C       389            mov a, #12
02EA 14         389            dec a
02EB 1200C7     389            lcall ?Set_Cursor_1 ; Select column and row
02EE D0E0       389            pop acc
02F0 C000       390            push ar0
02F2 A834       390            mov r0, BCD_Time_Seconds
02F4 1200CC     390            lcall ?Display_BCD
02F7 D000       390            pop ar0
02F9            391   
02F9 200755     392            JB Hour_Format_Flag, Update_Time_Hours_24
02FC 8000       393            SJMP Update_Time_Hours_12
02FE            394   Update_Time_Hours_12:
02FE C0E0       395            push acc
0300 7406       395            mov a, #6
0302 14         395            dec a
0303 1200C7     395            lcall ?Set_Cursor_1 ; Select column and row
0306 D0E0       395            pop acc
0308 C000       396            push ar0
030A A832       396            mov r0, BCD_Time_Hours
030C 1200CC     396            lcall ?Display_BCD
030F D000       396            pop ar0
0311 20051E     397            JB Time_PM_Flag, Update_Time_PM
0314            398   Update_Time_AM:
0314 C0E0       399            push acc
0316 740E       399            mov a, #14
0318 14         399            dec a
0319 1200C7     399            lcall ?Set_Cursor_1 ; Select column and row
031C D0E0       399            pop acc
031E C083       400            push dph
0320 C082       400            push dpl
0322 C0E0       400            push acc
0324 900107     400            mov dptr, #AM_MSG
0327 1200BA     400            lcall ?Send_Constant_String
032A D0E0       400            pop acc
032C D082       400            pop dpl
032E D083       400            pop dph
0330 801E       401            SJMP Update_Time_Display_End
0332            402   Update_Time_PM:
0332 C0E0       403            push acc
0334 740E       403            mov a, #14
0336 14         403            dec a
0337 1200C7     403            lcall ?Set_Cursor_1 ; Select column and row
033A D0E0       403            pop acc
033C C083       404            push dph
033E C082       404            push dpl
0340 C0E0       404            push acc
0342 90010A     404            mov dptr, #PM_MSG
0345 1200BA     404            lcall ?Send_Constant_String
0348 D0E0       404            pop acc
034A D082       404            pop dpl
034C D083       404            pop dph
034E 8000       405            SJMP Update_Time_Display_End
0350            406   Update_Time_Display_End:
0350 22         407            RET
0351            408   
0351            409   Update_Time_Hours_24:
0351 C0E0       410            push acc
0353 740E       410            mov a, #14
0355 14         410            dec a
0356 1200C7     410            lcall ?Set_Cursor_1 ; Select column and row
0359 D0E0       410            pop acc
035B C083       411            push dph
035D C082       411            push dpl
035F C0E0       411            push acc
0361 90010D     411            mov dptr, #BLANK_DISPLAY
0364 1200BA     411            lcall ?Send_Constant_String
0367 D0E0       411            pop acc
0369 D082       411            pop dpl
036B D083       411            pop dph
036D E532       412            MOV A, BCD_Time_Hours
036F 20052C     413            JB Time_PM_Flag, Update_Time_Hours_24_PM
0372            414   Update_Time_Hours_24_AM:
0372 C0E0       415            push acc
0374 7406       415            mov a, #6
0376 14         415            dec a
0377 1200C7     415            lcall ?Set_Cursor_1 ; Select column and row
037A D0E0       415            pop acc
037C C000       416            push ar0
037E F8         416            mov r0, A
037F 1200CC     416            lcall ?Display_BCD
0382 D000       416            pop ar0
0384 B412C9     417            CJNE A, #0X12, Update_Time_Display_End
0387 8000       418            SJMP Update_Time_0000
0389            419   Update_Time_0000:
0389 C0E0       420            push acc
038B 7406       420            mov a, #6
038D 14         420            dec a
038E 1200C7     420            lcall ?Set_Cursor_1 ; Select column and row
0391 D0E0       420            pop acc
0393 C000       421            push ar0
0395 7800       421            mov r0, #0X00
0397 1200CC     421            lcall ?Display_BCD
039A D000       421            pop ar0
039C 80B2       422            SJMP Update_Time_Display_End
039E            423   Update_Time_Hours_24_PM:
039E 2412       424            ADD A, #0X12
03A0 C0E0       425            push acc
03A2 7406       425            mov a, #6
03A4 14         425            dec a
03A5 1200C7     425            lcall ?Set_Cursor_1 ; Select column and row
03A8 D0E0       425            pop acc
03AA C000       426            push ar0
03AC F8         426            mov r0, A
03AD 1200CC     426            lcall ?Display_BCD
03B0 D000       426            pop ar0
03B2 E532       427            MOV A, BCD_Time_Hours
03B4 8000       428            SJMP Check_Time_2000
03B6            429   Check_Time_2000:
03B6 B40802     430            CJNE A, #0X08, Check_Time_2100
03B9 800A       431            SJMP Update_Time_2000
03BB            432   Check_Time_2100:
03BB B40902     433            CJNE A, #0X09, Check_Time_1200
03BE 801B       434            SJMP Update_Time_2100
03C0            435   Check_Time_1200:
03C0 B4128D     436            CJNE A, #0X12, Update_Time_Display_End
03C3 802C       437            SJMP Update_Time_1200
03C5            438   Update_Time_2000:
03C5 C0E0       439            push acc
03C7 7406       439            mov a, #6
03C9 14         439            dec a
03CA 1200C7     439            lcall ?Set_Cursor_1 ; Select column and row
03CD D0E0       439            pop acc
03CF C000       440            push ar0
03D1 7820       440            mov r0, #0x20
03D3 1200CC     440            lcall ?Display_BCD
03D6 D000       440            pop ar0
03D8 020350     441            LJMP Update_Time_Display_End
03DB            442   Update_Time_2100:
03DB C0E0       443            push acc
03DD 7406       443            mov a, #6
03DF 14         443            dec a
03E0 1200C7     443            lcall ?Set_Cursor_1 ; Select column and row
03E3 D0E0       443            pop acc
03E5 C000       444            push ar0
03E7 7821       444            mov r0, #0x021
03E9 1200CC     444            lcall ?Display_BCD
03EC D000       444            pop ar0
03EE 020350     445            LJMP Update_Time_Display_End
03F1            446   Update_Time_1200:
03F1 C0E0       447            push acc
03F3 7406       447            mov a, #6
03F5 14         447            dec a
03F6 1200C7     447            lcall ?Set_Cursor_1 ; Select column and row
03F9 D0E0       447            pop acc
03FB C000       448            push ar0
03FD 7812       448            mov r0, #0X12
03FF 1200CC     448            lcall ?Display_BCD
0402 D000       448            pop ar0
0404 020350     449            LJMP Update_Time_Display_End
0407            450   
0407            451   Update_Alarm_Display:
0407 200303     452            JB Alarm_En_Flag, Update_Alarm_En_On
040A 020566     453            LJMP Update_Alarm_En_Off
040D            454   Update_Alarm_En_On:
040D            455            ; Display Alarm
040D C0E0       456            push acc
040F 7401       456            mov a, #1
0411 14         456            dec a
0412 1200C5     456            lcall ?Set_Cursor_2 ; Select column and row
0415 D0E0       456            pop acc
0417 C083       457            push dph
0419 C082       457            push dpl
041B C0E0       457            push acc
041D 900101     457            mov dptr, #ALARM_UPDATE_MSG
0420 1200BA     457            lcall ?Send_Constant_String
0423 D0E0       457            pop acc
0425 D082       457            pop dpl
0427 D083       457            pop dph
0429 C0E0       458            push acc
042B 7409       458            mov a, #9
042D 14         458            dec a
042E 1200C5     458            lcall ?Set_Cursor_2 ; Select column and row
0431 D0E0       458            pop acc
0433 C083       459            push dph
0435 C082       459            push dpl
0437 C0E0       459            push acc
0439 90011E     459            mov dptr, #COLON
043C 1200BA     459            lcall ?Send_Constant_String
043F D0E0       459            pop acc
0441 D082       459            pop dpl
0443 D083       459            pop dph
0445            459   
0445 C0E0       460            push acc
0447 740A       460            mov a, #10
0449 14         460            dec a
044A 1200C5     460            lcall ?Set_Cursor_2 ; Select column and row
044D D0E0       460            pop acc
044F C000       461            push ar0
0451 A836       461            mov r0, BCD_Alarm_Minutes
0453 1200CC     461            lcall ?Display_BCD
0456 D000       461            pop ar0
0458            462   
0458 200755     463            JB Hour_Format_Flag, Update_Alarm_Hours_24
045B 8000       464            SJMP Update_Alarm_Hours_12
045D            465   Update_Alarm_Hours_12:
045D C0E0       466            push acc
045F 7407       466            mov a, #7
0461 14         466            dec a
0462 1200C5     466            lcall ?Set_Cursor_2 ; Select column and row
0465 D0E0       466            pop acc
0467 C000       467            push ar0
0469 A835       467            mov r0, BCD_Alarm_Hours
046B 1200CC     467            lcall ?Display_BCD
046E D000       467            pop ar0
0470 20061E     468            JB Alarm_PM_Flag, Update_Alarm_PM
0473            469   Update_Alarm_AM:
0473 C0E0       470            push acc
0475 740C       470            mov a, #12
0477 14         470            dec a
0478 1200C5     470            lcall ?Set_Cursor_2 ; Select column and row
047B D0E0       470            pop acc
047D C083       471            push dph
047F C082       471            push dpl
0481 C0E0       471            push acc
0483 900107     471            mov dptr, #AM_MSG
0486 1200BA     471            lcall ?Send_Constant_String
0489 D0E0       471            pop acc
048B D082       471            pop dpl
048D D083       471            pop dph
048F 801E       472       SJMP Update_Alarm_Display_End
0491            473   Update_Alarm_PM:
0491 C0E0       474            push acc
0493 740C       474            mov a, #12
0495 14         474            dec a
0496 1200C5     474            lcall ?Set_Cursor_2 ; Select column and row
0499 D0E0       474            pop acc
049B C083       475            push dph
049D C082       475            push dpl
049F C0E0       475            push acc
04A1 90010A     475            mov dptr, #PM_MSG
04A4 1200BA     475            lcall ?Send_Constant_String
04A7 D0E0       475            pop acc
04A9 D082       475            pop dpl
04AB D083       475            pop dph
04AD 8000       476       SJMP Update_Alarm_Display_End
04AF            477   Update_Alarm_Display_End:
04AF 22         478            RET
04B0            479   
04B0            480   Update_Alarm_Hours_24:
04B0 C0E0       481            push acc
04B2 740C       481            mov a, #12
04B4 14         481            dec a
04B5 1200C5     481            lcall ?Set_Cursor_2 ; Select column and row
04B8 D0E0       481            pop acc
04BA C083       482            push dph
04BC C082       482            push dpl
04BE C0E0       482            push acc
04C0 90010D     482            mov dptr, #BLANK_DISPLAY
04C3 1200BA     482            lcall ?Send_Constant_String
04C6 D0E0       482            pop acc
04C8 D082       482            pop dpl
04CA D083       482            pop dph
04CC E535       483            MOV A, BCD_Alarm_Hours
04CE 20062C     484            JB Alarm_PM_Flag, Update_Alarm_Hours_24_PM
04D1            485   Update_Alarm_Hours_24_AM:
04D1 C0E0       486            push acc
04D3 7407       486            mov a, #7
04D5 14         486            dec a
04D6 1200C5     486            lcall ?Set_Cursor_2 ; Select column and row
04D9 D0E0       486            pop acc
04DB C000       487            push ar0
04DD F8         487            mov r0, A
04DE 1200CC     487            lcall ?Display_BCD
04E1 D000       487            pop ar0
04E3 B412C9     488            CJNE A, #0X12, Update_Alarm_Display_End
04E6 8000       489            SJMP Update_Alarm_0000
04E8            490   Update_Alarm_0000:
04E8 C0E0       491            push acc
04EA 7407       491            mov a, #7
04EC 14         491            dec a
04ED 1200C5     491            lcall ?Set_Cursor_2 ; Select column and row
04F0 D0E0       491            pop acc
04F2 C000       492            push ar0
04F4 7800       492            mov r0, #0X00
04F6 1200CC     492            lcall ?Display_BCD
04F9 D000       492            pop ar0
04FB 80B2       493            SJMP Update_Alarm_Display_End
04FD            494   Update_Alarm_Hours_24_PM:
04FD 2412       495            ADD A, #0X12
04FF C0E0       496            push acc
0501 7407       496            mov a, #7
0503 14         496            dec a
0504 1200C5     496            lcall ?Set_Cursor_2 ; Select column and row
0507 D0E0       496            pop acc
0509 C000       497            push ar0
050B F8         497            mov r0, A
050C 1200CC     497            lcall ?Display_BCD
050F D000       497            pop ar0
0511 E535       498            MOV A, BCD_Alarm_Hours
0513 8000       499            SJMP Check_Alarm_2000
0515            500   Check_Alarm_2000:
0515 B40802     501            CJNE A, #0X08, Check_Alarm_2100
0518 800A       502            SJMP Update_Alarm_2000
051A            503   Check_Alarm_2100:
051A B40902     504            CJNE A, #0X09, Check_Alarm_1200
051D 801B       505            SJMP Update_Alarm_2100
051F            506   Check_Alarm_1200:
051F B4128D     507            CJNE A, #0X12, Update_Alarm_Display_End
0522 802C       508            SJMP Update_Alarm_1200
0524            509   Update_Alarm_2000:
0524 C0E0       510            push acc
0526 7407       510            mov a, #7
0528 14         510            dec a
0529 1200C5     510            lcall ?Set_Cursor_2 ; Select column and row
052C D0E0       510            pop acc
052E C000       511            push ar0
0530 7820       511            mov r0, #0x20
0532 1200CC     511            lcall ?Display_BCD
0535 D000       511            pop ar0
0537 0204AF     512            LJMP Update_Alarm_Display_End
053A            513   Update_Alarm_2100:
053A C0E0       514            push acc
053C 7407       514            mov a, #7
053E 14         514            dec a
053F 1200C5     514            lcall ?Set_Cursor_2 ; Select column and row
0542 D0E0       514            pop acc
0544 C000       515            push ar0
0546 7821       515            mov r0, #0x021
0548 1200CC     515            lcall ?Display_BCD
054B D000       515            pop ar0
054D 0204AF     516            LJMP Update_Alarm_Display_End
0550            517   Update_Alarm_1200:
0550 C0E0       518            push acc
0552 7407       518            mov a, #7
0554 14         518            dec a
0555 1200C5     518            lcall ?Set_Cursor_2 ; Select column and row
0558 D0E0       518            pop acc
055A C000       519            push ar0
055C 7812       519            mov r0, #0X12
055E 1200CC     519            lcall ?Display_BCD
0561 D000       519            pop ar0
0563 0204AF     520            LJMP Update_Alarm_Display_End
0566            521   
0566            522   Update_Alarm_En_Off:
0566 C0E0       523            push acc
0568 7401       523            mov a, #1
056A 14         523            dec a
056B 1200C5     523            lcall ?Set_Cursor_2 ; Select column and row
056E D0E0       523            pop acc
0570 C083       524            push dph
0572 C082       524            push dpl
0574 C0E0       524            push acc
0576 90010D     524            mov dptr, #BLANK_DISPLAY
0579 1200BA     524            lcall ?Send_Constant_String
057C D0E0       524            pop acc
057E D082       524            pop dpl
0580 D083       524            pop dph
0582 0204AF     525            LJMP Update_Alarm_Display_End
0585            526   
0585            527   ;-------------------------------;
0585            528   ; Update Time on LCD Display ;
0585            529   ;-------------------------------;
0585            530   Update_Time_Hours:
0585 300106     531            JNB Init_Time_Flag, Inc_Time_Hours
0588 300203     532            JNB Dec_En_Flag, Inc_Time_Hours
058B 0205AA     533            LJMP Dec_Time_Hours
058E            534   
058E            535   Inc_Time_Hours:
058E E532       536            MOV A, BCD_Time_Hours
0590 2401       537            ADD A, #1
0592 D4         538            DA A
0593 F532       539            MOV BCD_Time_Hours, A
0595 9412       540            SUBB A, #0X12
0597 4010       541            JC Update_Time_Hours_Done
0599 7007       542            JNZ Offset_Time_Hours
059B            543   Toggle_Time_AMPM:
059B 753212     544            MOV BCD_Time_Hours, #0X12
059E B205       545            CPL Time_PM_Flag
05A0 8007       546            SJMP Update_Time_Hours_Done
05A2            547   Offset_Time_Hours:
05A2 E532       548            MOV A, BCD_Time_Hours
05A4 9412       549            SUBB A, #0X12
05A6 D4         550            DA A
05A7 F532       551            MOV BCD_Time_Hours, A
05A9            552   Update_Time_Hours_Done:
05A9 22         553            RET
05AA            554   
05AA            555   Dec_Time_Hours:
05AA E532       556            MOV A, BCD_Time_Hours
05AC B41207     557            CJNE A, #0X12, Dec_Time_Hours_Continued
05AF            558   Rewind_Time_AMPM:
05AF 753211     559            MOV BCD_Time_Hours, #0X11
05B2 B205       560            CPL Time_PM_Flag
05B4 80F3       561            SJMP Update_Time_Hours_Done
05B6            562   Dec_Time_Hours_Continued:
05B6 2499       563            ADD A, #0X99 ; Adding 10-Complement of -1
05B8 D4         564            DA A
05B9 F532       565            MOV BCD_Time_Hours, A
05BB 70EC       566            JNZ Update_Time_Hours_Done
05BD            567   Rewind_Time_Hours:
05BD 753212     568            MOV BCD_Time_Hours, #0X12
05C0 80E7       569            SJMP Update_Time_Hours_Done
05C2            570   
05C2            571   
05C2            572   Update_Time_Minutes:
05C2 300106     573            JNB Init_Time_Flag, Inc_Time_Minutes
05C5 300203     574            JNB Dec_En_Flag, Inc_Time_Minutes
05C8 0205E0     575            LJMP Dec_Time_Minutes
05CB            576   
05CB            577   Inc_Time_Minutes:
05CB E533       578            MOV A, BCD_Time_Minutes
05CD 2401       579            ADD A, #1
05CF D4         580            DA A
05D0 F533       581            MOV BCD_Time_Minutes, A
05D2 B4600A     582            CJNE A, #0X60, Update_Time_Minutes_Done
05D5 8000       583            SJMP Reset_Time_Minutes
05D7            584   Reset_Time_Minutes:
05D7 753300     585            MOV BCD_Time_Minutes, #0X00
05DA 120585     586            LCALL Update_Time_Hours
05DD 8000       587            SJMP Update_Time_Minutes_Done
05DF            588   Update_Time_Minutes_Done:
05DF 22         589            RET
05E0            590   
05E0            591   Dec_Time_Minutes:
05E0 E533       592            MOV A, BCD_Time_Minutes
05E2 7008       593            JNZ Dec_Time_Minutes_Continued
05E4            594   Rewind_Time_Minutes:
05E4 753359     595            MOV BCD_Time_Minutes, #0X59
05E7 120585     596            LCALL Update_Time_Hours
05EA 80F3       597            SJMP Update_Time_Minutes_Done
05EC            598   Dec_Time_Minutes_Continued:
05EC 2499       599            ADD A, #0X99 ; Adding 10-Complement of -1
05EE D4         600            DA A
05EF F533       601            MOV BCD_Time_Minutes, A
05F1 80EC       602            SJMP Update_Time_Minutes_Done
05F3            603   
05F3            604   Update_Time_Seconds:
05F3 300106     605            JNB Init_Time_Flag, Inc_Time_Seconds
05F6 300203     606            JNB Dec_En_Flag, Inc_Time_Seconds
05F9 020611     607            LJMP Dec_Time_Seconds
05FC            608   
05FC            609   Inc_Time_Seconds:
05FC E534       610            MOV A, BCD_Time_Seconds
05FE 2401       611            ADD A, #1
0600 D4         612            DA A
0601 F534       613            MOV BCD_Time_Seconds, A
0603 B4600A     614            CJNE A, #0X60, Update_Time_Seconds_Done
0606 8000       615            SJMP Reset_Time_Seconds
0608            616   Reset_Time_Seconds:
0608 753400     617            MOV BCD_Time_Seconds, #0X00
060B 1205C2     618            LCALL Update_Time_Minutes
060E 8000       619            SJMP Update_Time_Seconds_Done
0610            620   Update_Time_Seconds_Done:
0610 22         621            RET
0611            622   
0611            623   Dec_Time_Seconds:
0611 E534       624            MOV A, BCD_Time_Seconds
0613 7008       625            JNZ Dec_Time_Seconds_Continued
0615            626   Rewind_Time_Seconds:
0615 753459     627            MOV BCD_Time_Seconds, #0X59
0618 1205C2     628            LCALL Update_Time_Minutes
061B 80F3       629            SJMP Update_Time_Seconds_Done
061D            630   Dec_Time_Seconds_Continued:
061D 2499       631            ADD A, #0X99 ; Adding 10-Complement of -1
061F D4         632            DA A
0620 F534       633            MOV BCD_Time_Seconds, A
0622 80EC       634            SJMP Update_Time_Seconds_Done
0624            635   
0624            636   Update_Alarm_Hours:
0624 300203     637            JNB Dec_En_Flag, Inc_Alarm_Hours
0627 020648     638            LJMP Dec_Alarm_Hours
062A            639   
062A            640   Inc_Alarm_Hours:
062A E535       641            MOV A, BCD_Alarm_Hours
062C 2401       642            ADD A, #1
062E D4         643            DA A
062F F535       644            MOV BCD_Alarm_Hours, A
0631 9412       645            SUBB A, #0X12
0633 4012       646            JC Update_Alarm_Hours_Done
0635 7007       647            JNZ Offset_Alarm_Hours
0637            648   Toggle_Alarm_AMPM:
0637 753512     649            MOV BCD_Alarm_Hours, #0X12
063A B206       650            CPL Alarm_PM_Flag
063C 8009       651            SJMP Update_Alarm_Hours_Done
063E            652   Offset_Alarm_Hours:
063E E535       653            MOV A, BCD_Alarm_Hours
0640 9412       654            SUBB A, #0X12
0642 D4         655            DA A
0643 F535       656            MOV BCD_Alarm_Hours, A
0645 8000       657            SJMP Update_Alarm_Hours_Done
0647            658   Update_Alarm_Hours_Done:
0647 22         659            RET
0648            660   
0648            661   Dec_Alarm_Hours:
0648 E535       662            MOV A, BCD_Alarm_Hours
064A B41207     663            CJNE A, #0X12, Dec_Alarm_Hours_Continued
064D            664   Rewind_Alarm_AMPM:
064D 753511     665            MOV BCD_Alarm_Hours, #0X11
0650 B206       666            CPL Alarm_PM_Flag
0652 80F3       667            SJMP Update_Alarm_Hours_Done
0654            668   Dec_Alarm_Hours_Continued:
0654 2499       669            ADD A, #0X99 ; Adding 10-Complement of -1
0656 D4         670            DA A
0657 F535       671            MOV BCD_Alarm_Hours, A
0659 70EC       672            JNZ Update_Alarm_Hours_Done
065B            673   Rewind_Alarm_Hours:
065B 753512     674            MOV BCD_Alarm_Hours, #0X12
065E 80E7       675            SJMP Update_Alarm_Hours_Done
0660            676   
0660            677   
0660            678   Update_Alarm_Minutes:
0660 300203     679            JNB Dec_En_Flag, Inc_Alarm_Minutes
0663 02067B     680            LJMP Dec_Alarm_Minutes
0666            681   
0666            682   Inc_Alarm_Minutes:
0666 E536       683            MOV A, BCD_Alarm_Minutes
0668 2401       684            ADD A, #1
066A D4         685            DA A
066B F536       686            MOV BCD_Alarm_Minutes, A
066D B4600A     687            CJNE A, #0X60, Update_Alarm_Minutes_Done
0670 8000       688            SJMP Reset_Alarm_Minutes
0672            689   Reset_Alarm_Minutes:
0672 753600     690            MOV BCD_Alarm_Minutes, #0X00
0675 120624     691            LCALL Update_Alarm_Hours
0678 8000       692            SJMP Update_Alarm_Minutes_Done
067A            693   Update_Alarm_Minutes_Done:
067A 22         694            RET
067B            695   
067B            696   Dec_Alarm_Minutes:
067B E536       697            MOV A, BCD_Alarm_Minutes
067D 7008       698            JNZ Dec_Alarm_Minutes_Continued
067F            699   Rewind_Alarm_Minutes:
067F 753659     700            MOV BCD_Alarm_Minutes, #0X59
0682 120624     701            LCALL Update_Alarm_Hours
0685 80F3       702            SJMP Update_Alarm_Minutes_Done
0687            703   Dec_Alarm_Minutes_Continued:
0687 2499       704            ADD A, #0X99 ; Adding 10-Complement of -1
0689 D4         705            DA A
068A F536       706            MOV BCD_Alarm_Minutes, A
068C 80EC       707            SJMP Update_Alarm_Minutes_Done
068E            708   
068E            709   ;----------------;
068E            710   ; Enable/Disable ;
068E            711   ;----------------;
068E            712   Check_Alarm_En:
068E 209011     713            JB SET_BUTTON, Check_Alarm_En_Done
0691 C002       714            push AR2
0693 7A32       714            mov R2, #50
0695 120038     714            lcall ?Wait_Milli_Seconds
0698 D002       714            pop AR2
069A 209005     715            JB SET_BUTTON, Check_Alarm_En_Done
069D 3090FD     716            JNB SET_BUTTON, $ ; Wait for Rising Edge
06A0 B203       717            CPL Alarm_En_Flag ; Toggle Alarm Enable Flag
06A2            718   Check_Alarm_En_Done:
06A2 22         719            RET
06A3            720   
06A3            721   Check_Dec_En:
06A3 208511     722            JB DEC_BUTTON, Check_Dec_En_Done
06A6 C002       723            push AR2
06A8 7A32       723            mov R2, #50
06AA 120038     723            lcall ?Wait_Milli_Seconds
06AD D002       723            pop AR2
06AF 208505     724            JB DEC_BUTTON, Check_Dec_En_Done
06B2 3085FD     725            JNB DEC_BUTTON, $ ; Wait for Rising Edge
06B5 B202       726            CPL Dec_En_Flag
06B7            727   Check_Dec_En_Done:
06B7 22         728            RET
06B8            729   
06B8            730   Check_Hour_Format:
06B8 209111     731            JB HOUR_FORMAT_BUTTON, Check_Hour_Format_Done
06BB C002       732            push AR2
06BD 7A32       732            mov R2, #50
06BF 120038     732            lcall ?Wait_Milli_Seconds
06C2 D002       732            pop AR2
06C4 209105     733            JB HOUR_FORMAT_BUTTON, Check_Hour_Format_Done
06C7 3091FD     734            JNB HOUR_FORMAT_BUTTON, $ ; Wait for Rising Edge
06CA B207       735            CPL Hour_Format_Flag
06CC            736   Check_Hour_Format_Done:
06CC 22         737            RET
06CD            738   END
